<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SQL - Apuntes de Programación</title>
    <link rel="stylesheet" href="../styles.css">
    <svg xmlns="http://www.w3.org/2000/svg" style="display: none;">
        <symbol id="dev-icon" viewBox="0 0 448 512">
            <path d="M120.12 208.29c-3.88-2.9-7.77-4.35-11.65-4.35H91.03v104.47h17.45c3.88 0 7.77-1.45 11.65-4.35 3.88-2.9 5.82-7.25 5.82-13.06v-69.65c-.01-5.8-1.96-10.16-5.83-13.06zM404.1 32H43.9C19.7 32 .06 51.59 0 75.8v360.4C.06 460.41 19.7 480 43.9 480h360.2c24.21 0 43.84-19.59 43.9-43.8V75.8c-.06-24.21-19.7-43.8-43.9-43.8zM154.2 291.19c0 18.81-11.61 47.31-48.36 47.25h-46.4V172.98h47.38c35.44 0 47.36 28.46 47.37 47.28l.01 70.93zm100.68-88.66H201.6v38.42h32.57v29.57H201.6v38.41h53.29v29.57h-62.18c-11.16.29-20.44-8.53-20.72-19.69V193.7c-.27-11.15 8.56-20.41 19.71-20.69h63.19l-.01 29.52zm103.64 115.29c-13.2 30.75-36.85 24.63-47.44 0l-38.53-144.8h32.57l29.71 113.72 29.57-113.72h32.58l-38.46 144.8z"/>
        </symbol>
        <symbol id="sql-icon" viewBox="0 0 448 512">
            <path d="M448 73.143v45.714C448 159.143 347.667 192 224 192S0 159.143 0 118.857V73.143C0 32.857 100.333 0 224 0s224 32.857 224 73.143zM448 176v102.857C448 319.143 347.667 352 224 352S0 319.143 0 278.857V176c48.125 33.143 136.208 48.572 224 48.572S399.874 209.143 448 176zm0 160v102.857C448 479.143 347.667 512 224 512S0 479.143 0 438.857V336c48.125 33.143 136.208 48.572 224 48.572S399.874 369.143 448 336z"/>
        </symbol>
        <symbol id="git-icon" viewBox="0 0 92 92">
            <path d="M90.156,41.965,50.036,1.844a5.918,5.918,0,0,0-8.372,0L33.3,10.208l10.6,10.6a7.027,7.027,0,0,1,7.2,1.688,7.033,7.033,0,0,1,1.687,7.275l10.2,10.2a7.039,7.039,0,1,1-4.227,3.975,6.974,6.974,0,0,1,.7-3.041L49.612,30.8V63.34a7.039,7.039,0,1,1-5.781-.207V30.336a7.048,7.048,0,0,1-3.816-9.234l-10.44-10.44L1.844,38.394a5.918,5.918,0,0,0,0,8.372L41.965,86.887a5.918,5.918,0,0,0,8.372,0L90.156,50.337A5.918,5.918,0,0,0,90.156,41.965Z"/>
        </symbol>
        <symbol id="js-icon" viewBox="0 0 448 512">
            <path d="M400 32H48C21.5 32 0 53.5 0 80v352c0 26.5 21.5 48 48 48h352c26.5 0 48-21.5 48-48V80c0-26.5-21.5-48-48-48zM243.8 381.4c0 43.6-25.6 63.5-62.9 63.5-33.7 0-53.2-17.4-63.2-38.5l34.3-20.7c6.6 11.7 12.6 21.6 27.1 21.6 13.8 0 22.6-5.4 22.6-26.5V237.7h42.1v143.7zm99.6 63.5c-39.1 0-64.4-18.6-76.7-43l34.3-19.8c9 14.7 20.8 25.6 41.5 25.6 17.4 0 28.6-8.7 28.6-20.8 0-14.4-11.4-19.5-30.7-28l-10.5-4.5c-30.4-12.9-50.5-29.2-50.5-63.5 0-31.6 24.1-55.6 61.6-55.6 26.8 0 46 9.3 59.8 33.7L368 290c-7.2-12.9-15-18-27.1-18-12.3 0-20.1 7.8-20.1 18 0 12.6 7.8 17.7 25.9 25.6l10.5 4.5c35.8 15.3 55.9 31 55.9 66.2 0 37.8-29.8 58.6-69.7 58.6z"/>
        </symbol>
        <symbol id="sun-icon" viewBox="0 0 24 24">
            <path d="M12 3a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0V4a1 1 0 0 1 1-1zm7.071 2.929a1 1 0 0 1 0 1.414l-.707.707a1 1 0 1 1-1.414-1.414l.707-.707a1 1 0 0 1 1.414 0zm-14.142 0a1 1 0 0 1 1.414 0l.707.707A1 1 0 0 1 5.636 8.05l-.707-.707a1 1 0 0 1 0-1.414zM12 8a4 4 0 1 1 0 8 4 4 0 0 1 0-8zm-8 4a1 1 0 0 1 1 1 1 1 0 1 1-2 0 1 1 0 0 1 1-1zm16 0a1 1 0 1 1 0 2 1 1 0 0 1 0-2zM5.636 15.95a1 1 0 0 1 1.414 1.414l-.707.707a1 1 0 0 1-1.414-1.414l.707-.707zm12.728 0l.707.707a1 1 0 0 1-1.414 1.414l-.707-.707a1 1 0 0 1 1.414-1.414zM12 19a1 1 0 0 1 1 1v1a1 1 0 1 1-2 0v-1a1 1 0 0 1 1-1z"/>
        </symbol>
        <symbol id="moon-icon" viewBox="0 0 24 24">
            <path d="M12 3c.132 0 .263 0 .393 0a7.5 7.5 0 0 0 7.92 12.446A9 9 0 1 1 12 3z"/>
        </symbol>
    </svg>
    <script type="module">
        import { toggleTheme, detectColorScheme } from '../js/theme.js';
        import UnifiedNavigation from '../js/unified-navigation.js';
        import ProgressTracker from '../js/progress.js';

        // Initial theme detection
        detectColorScheme();

        // Set up theme toggle button
        document.getElementById('theme-toggle').addEventListener('click', toggleTheme);

        // Update progress when content is marked as completed
        function updateProgress() {
            const progress = ProgressTracker.getLanguageProgress('sql');
            document.querySelectorAll('[data-section]').forEach(section => {
                const sectionName = section.dataset.section;
                if (progress.sections[sectionName]) {
                    section.classList.add('completed');
                }
            });
        }

        document.addEventListener('DOMContentLoaded', updateProgress);
    </script>
</head>
<body>
    <nav class="top-nav">
        <div class="nav-content">
            <ul class="nav-links">
                <li><a href="../"></svg>Home</a></li>
                <li><a href="/git/"><svg class="nav-icon"><use href="#git-icon"/></svg>Git</a></li>
                <li><a href="/js/"><svg class="nav-icon"><use href="#js-icon"/></svg>JavaScript</a></li>
                <li><a href="/sql/"><svg class="nav-icon"><use href="#sql-icon"/></svg>SQL</a></li>
            </ul>
            <div class="nav-title">
                <svg class="nav-icon"><use href="#sql-icon"/></svg>
                <h1>SQL</h1>
            </div>
            <button id="theme-toggle" class="theme-toggle">
                <svg class="theme-icon sun"><use href="#sun-icon"/></svg>
                <svg class="theme-icon moon"><use href="#moon-icon"/></svg>
            </button>
        </div>
    </nav>

    <div class="container">


        <div class="topics-container">
            <div class="progress-sidebar">
                <section class="topic-section" data-section="fundamentals">
                    <h2>Fundamentos de Bases de Datos</h2>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </section>

                <section class="topic-section" data-section="queries">
                    <h2>Consultas SQL</h2>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </section>

                <section class="topic-section" data-section="management">
                    <h2>Gestión de Bases de Datos</h2>
                    <div class="progress-bar">
                        <div class="progress" style="width: 0%"></div>
                    </div>
                </section>
            </div>

            <div class="content-area">
                <div id="fundamentals-content" class="topic-content">
                    <h2>Fundamentos de Bases de Datos</h2>
                    
                    <h3>Conceptos básicos de bases de datos relacionales</h3>
                    <p>Una base de datos relacional organiza los datos en tablas con filas y columnas:</p>
                    <div class="code-block">
                        <pre><code>-- Crear una tabla
CREATE TABLE usuarios (
    id INT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    fecha_registro DATE DEFAULT CURRENT_DATE
);</code></pre>
                    </div>
                    
                    <h3>Diseño de esquemas y normalización</h3>
                    <p>La normalización ayuda a eliminar la redundancia y mejorar la integridad de los datos:</p>
                    <div class="code-block">
                        <pre><code>-- Ejemplo de esquema normalizado
CREATE TABLE categorias (
    id INT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL
);

CREATE TABLE productos (
    id INT PRIMARY KEY,
    nombre VARCHAR(100) NOT NULL,
    precio DECIMAL(10, 2),
    categoria_id INT,
    FOREIGN KEY (categoria_id) REFERENCES categorias(id)
);</code></pre>
                    </div>
                    
                    <h3>Tipos de datos y restricciones</h3>
                    <p>SQL ofrece varios tipos de datos y restricciones para mantener la integridad:</p>
                    <div class="code-block">
                        <pre><code>-- Tipos de datos comunes
INT               -- Números enteros
DECIMAL(p, s)     -- Números decimales con precisión p y escala s
VARCHAR(n)        -- Cadenas de texto de longitud variable
DATE              -- Fechas
TIMESTAMP         -- Fecha y hora
BOOLEAN           -- Valores verdadero/falso

-- Restricciones
PRIMARY KEY       -- Clave primaria, identifica de forma única cada fila
FOREIGN KEY       -- Clave foránea, mantiene la integridad referencial
UNIQUE            -- Garantiza valores únicos en una columna
NOT NULL          -- No permite valores nulos
CHECK             -- Valida que los datos cumplan una condición</code></pre>
                    </div>
                    
                    <div class="practice-example">
                        <h3>Ejercicio práctico: Diseño de una base de datos</h3>
                        <div class="description">
                            <p>Diseña un esquema de base de datos para una biblioteca que almacene información sobre libros, autores y préstamos.</p>
                        </div>
                        <button class="solution-toggle">Ver solución</button>
                        <div class="solution">
                            <div class="code-block">
                                <pre><code>-- Tabla de autores
CREATE TABLE autores (
    autor_id INT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellido VARCHAR(50) NOT NULL,
    fecha_nacimiento DATE
);

-- Tabla de libros
CREATE TABLE libros (
    libro_id INT PRIMARY KEY,
    titulo VARCHAR(100) NOT NULL,
    isbn VARCHAR(13) UNIQUE,
    anio_publicacion INT,
    editorial VARCHAR(50),
    disponible BOOLEAN DEFAULT TRUE
);

-- Tabla de relación entre libros y autores (muchos a muchos)
CREATE TABLE libro_autor (
    libro_id INT,
    autor_id INT,
    PRIMARY KEY (libro_id, autor_id),
    FOREIGN KEY (libro_id) REFERENCES libros(libro_id),
    FOREIGN KEY (autor_id) REFERENCES autores(autor_id)
);

-- Tabla de usuarios
CREATE TABLE usuarios (
    usuario_id INT PRIMARY KEY,
    nombre VARCHAR(50) NOT NULL,
    apellido VARCHAR(50) NOT NULL,
    email VARCHAR(100) UNIQUE,
    telefono VARCHAR(15)
);

-- Tabla de préstamos
CREATE TABLE prestamos (
    prestamo_id INT PRIMARY KEY,
    libro_id INT,
    usuario_id INT,
    fecha_prestamo DATE NOT NULL DEFAULT CURRENT_DATE,
    fecha_devolucion_prevista DATE NOT NULL,
    fecha_devolucion_real DATE,
    FOREIGN KEY (libro_id) REFERENCES libros(libro_id),
    FOREIGN KEY (usuario_id) REFERENCES usuarios(usuario_id)
);</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="completion-section">
                        <label>
                            <input type="checkbox" class="completion-checkbox" data-language="sql" data-section="fundamentals">
                            Marcar como completado
                        </label>
                    </div>
                </div>

                <div id="queries-content" class="topic-content" style="display: none;">
                    <h2>Consultas SQL</h2>
                    
                    <h3>SELECT, INSERT, UPDATE, DELETE</h3>
                    <p>Las operaciones CRUD (Crear, Leer, Actualizar, Eliminar) son fundamentales en SQL:</p>
                    <div class="code-block">
                        <pre><code>-- SELECT: Consultar datos
SELECT * FROM usuarios;
SELECT nombre, email FROM usuarios WHERE id > 100;

-- INSERT: Insertar datos
INSERT INTO usuarios (nombre, email) VALUES ('Ana García', 'ana@ejemplo.com');

-- UPDATE: Actualizar datos
UPDATE usuarios SET email = 'nuevo@ejemplo.com' WHERE id = 5;

-- DELETE: Eliminar datos
DELETE FROM usuarios WHERE id = 10;</code></pre>
                    </div>
                    
                    <h3>JOIN y subconsultas</h3>
                    <p>Los JOIN permiten combinar datos de múltiples tablas:</p>
                    <div class="code-block">
                        <pre><code>-- INNER JOIN: Solo filas que coinciden en ambas tablas
SELECT p.nombre, c.nombre as categoria
FROM productos p
INNER JOIN categorias c ON p.categoria_id = c.id;

-- LEFT JOIN: Todas las filas de la tabla izquierda
SELECT u.nombre, p.fecha_prestamo
FROM usuarios u
LEFT JOIN prestamos p ON u.id = p.usuario_id;

-- Subconsultas
SELECT nombre
FROM productos
WHERE precio > (SELECT AVG(precio) FROM productos);</code></pre>
                    </div>
                    
                    <h3>Funciones agregadas y GROUP BY</h3>
                    <p>Las funciones agregadas realizan cálculos sobre conjuntos de filas:</p>
                    <div class="code-block">
                        <pre><code>-- Funciones agregadas
SELECT COUNT(*) FROM usuarios;  -- Contar filas
SELECT AVG(precio) FROM productos;  -- Promedio
SELECT MAX(precio) FROM productos;  -- Valor máximo
SELECT MIN(precio) FROM productos;  -- Valor mínimo
SELECT SUM(precio) FROM productos;  -- Suma

-- GROUP BY: Agrupar resultados
SELECT categoria_id, COUNT(*) as total_productos
FROM productos
GROUP BY categoria_id;

-- HAVING: Filtrar grupos
SELECT categoria_id, AVG(precio) as precio_promedio
FROM productos
GROUP BY categoria_id
HAVING AVG(precio) > 100;</code></pre>
                    </div>
                    
                    <div class="practice-example">
                        <h3>Ejercicio práctico: Consultas avanzadas</h3>
                        <div class="description">
                            <p>Dada una base de datos de una tienda con tablas de clientes, productos, pedidos y detalles_pedido, escribe consultas SQL para:</p>
                            <ol>
                                <li>Listar los 5 productos más vendidos</li>
                                <li>Encontrar clientes que no han realizado compras en el último año</li>
                            </ol>
                        </div>
                        <button class="solution-toggle">Ver solución</button>
                        <div class="solution">
                            <div class="code-block">
                                <pre><code>-- 1. Los 5 productos más vendidos
SELECT p.nombre, SUM(dp.cantidad) as total_vendido
FROM productos p
INNER JOIN detalles_pedido dp ON p.producto_id = dp.producto_id
GROUP BY p.producto_id, p.nombre
ORDER BY total_vendido DESC
LIMIT 5;

-- 2. Clientes sin compras en el último año
SELECT c.cliente_id, c.nombre, c.apellido
FROM clientes c
LEFT JOIN pedidos p ON c.cliente_id = p.cliente_id AND p.fecha_pedido >= DATE_SUB(CURRENT_DATE, INTERVAL 1 YEAR)
WHERE p.pedido_id IS NULL;</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="completion-section">
                        <label>
                            <input type="checkbox" class="completion-checkbox" data-language="sql" data-section="queries">
                            Marcar como completado
                        </label>
                    </div>
                </div>

                <div id="management-content" class="topic-content" style="display: none;">
                    <h2>Gestión de Bases de Datos</h2>
                    
                    <h3>Índices y optimización</h3>
                    <p>Los índices mejoran el rendimiento de las consultas:</p>
                    <div class="code-block">
                        <pre><code>-- Crear un índice
CREATE INDEX idx_usuarios_email ON usuarios(email);

-- Índice compuesto (múltiples columnas)
CREATE INDEX idx_productos_cat_precio ON productos(categoria_id, precio);

-- Eliminar un índice
DROP INDEX idx_usuarios_email;

-- Analizar el rendimiento de una consulta
EXPLAIN SELECT * FROM usuarios WHERE email = 'ejemplo@mail.com';</code></pre>
                    </div>
                    
                    <h3>Transacciones y ACID</h3>
                    <p>Las transacciones garantizan la integridad de los datos:</p>
                    <div class="code-block">
                        <pre><code>-- Iniciar una transacción
BEGIN TRANSACTION;

-- Operaciones dentro de la transacción
UPDATE cuentas SET saldo = saldo - 1000 WHERE id = 1;
UPDATE cuentas SET saldo = saldo + 1000 WHERE id = 2;

-- Si todo está bien, confirmar los cambios
COMMIT;

-- Si hay un problema, deshacer los cambios
-- ROLLBACK;</code></pre>
                    </div>
                    
                    <h3>Seguridad y permisos</h3>
                    <p>Control de acceso a la base de datos:</p>
                    <div class="code-block">
                        <pre><code>-- Crear un usuario
CREATE USER 'usuario_lectura'@'localhost' IDENTIFIED BY 'contraseña';

-- Otorgar permisos
GRANT SELECT ON base_datos.* TO 'usuario_lectura'@'localhost';

-- Permisos más específicos
GRANT SELECT, INSERT, UPDATE ON base_datos.productos TO 'usuario_admin'@'localhost';

-- Revocar permisos
REVOKE INSERT ON base_datos.productos FROM 'usuario_admin'@'localhost';

-- Eliminar usuario
DROP USER 'usuario_lectura'@'localhost';</code></pre>
                    </div>
                    
                    <div class="practice-example">
                        <h3>Ejercicio práctico: Optimización de consultas</h3>
                        <div class="description">
                            <p>Tienes una tabla de ventas con millones de registros que está teniendo problemas de rendimiento. Propón una solución utilizando índices y explica cómo verificar la mejora.</p>
                        </div>
                        <button class="solution-toggle">Ver solución</button>
                        <div class="solution">
                            <div class="code-block">
                                <pre><code>-- 1. Analizar las consultas problemáticas
EXPLAIN SELECT * FROM ventas WHERE fecha BETWEEN '2023-01-01' AND '2023-12-31';

-- 2. Crear índices apropiados
CREATE INDEX idx_ventas_fecha ON ventas(fecha);
CREATE INDEX idx_ventas_producto_fecha ON ventas(producto_id, fecha);

-- 3. Verificar la mejora con EXPLAIN
EXPLAIN SELECT * FROM ventas WHERE fecha BETWEEN '2023-01-01' AND '2023-12-31';

-- 4. Considerar particionamiento para tablas muy grandes
ALTER TABLE ventas
PARTITION BY RANGE (YEAR(fecha)) (
    PARTITION p2021 VALUES LESS THAN (2022),
    PARTITION p2022 VALUES LESS THAN (2023),
    PARTITION p2023 VALUES LESS THAN (2024),
    PARTITION p2024 VALUES LESS THAN (2025)
);</code></pre>
                            </div>
                        </div>
                    </div>
                    
                    <div class="completion-section">
                        <label>
                            <input type="checkbox" class="completion-checkbox" data-language="sql" data-section="management">
                            Marcar como completado
                        </label>
                    </div>
                </div>

                <div class="content-navigation">
                    <button class="nav-button" id="prev-topic" disabled>← Anterior</button>
                    <span class="current-topic">Fundamentos de Bases de Datos</span>
                    <button class="nav-button" id="next-topic">Siguiente →</button>
                </div>
            </div>
        </div>
    </div>
</body>
</html>